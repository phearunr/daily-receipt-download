import{K as j,r as m,y as V,q as D,m as R,j as M,d,a as e,t as r,e as z,b as f,w as g,F as C,z as _,o as c,f as S,g as q,k as F,A as L}from"./app-db99a8de.js";import{l as N}from"./lodash-4ae8787a.js";import{t as K}from"./toast-fa86451f.js";import P from"./BarcodeSearchVerifyModal-7df29adb.js";import{_ as E}from"./_plugin-vue_export-helper-c27b6911.js";import{q as H,K as U,Y,z as A,S as I,h as G}from"./transition-3d77d2f5.js";function J(){return{hasBasketCount:()=>j().props.auth.user.basketCount}}const Q={components:{Dialog:H,DialogOverlay:U,DialogTitle:Y,DialogDescription:A,TransitionRoot:I,TransitionChild:G,BarcodeSearchVerifyModal:P},setup(){let p=m(!1),s=m(null),{hasBasketCount:B}=J();const o=V({latitude:null,longitude:null,pinpoint:null,items:null}),a=m([]),T=m([]);m(0);const w=()=>{u()},u=N.debounce(async t=>{let{data:n}=await D.get(route("baskets.users.index"),{params:{term:t}});a.value=n,await R(),T.value=[]},250),v=(t,n)=>{let i=a.value[t].order_items[n].drop_quantity,b=a.value[t].order_items[n].order_quantity;return a.value[t].order_items[n].drop_status=b==i?1:0},y=M(()=>{let t=0;return a.value.map((n,i)=>{n.order_items.map((b,O)=>{t+=b.drop_quantity,v(i,O)})}),t}),k=M(()=>{let t=0;return a.value.map(n=>{n.order_items.map(i=>{t+=i.order_quantity})}),t}),x=()=>{navigator.geolocation.getCurrentPosition(t=>{o.latitude=t.coords.latitude,o.longitude=t.coords.longitude,o.pinpoint=[t.coords.latitude,t.coords.longitude],o.orders=a.value},t=>!1)},l=async()=>{x(),D.put(route("baskets.users.confirm",1),{latitude:o.latitude,longitude:o.longitude,pinpoint:o.pinpoint,orders:o.orders}).then(t=>{t.data.errors?h(t.data.errors.pinpoint[0]):(h(t.data.success),u(),o.reset("orders","pinpoint","latitude","longitude"))}).catch(t=>{})},h=t=>{K.add({message:t??"msg"})};return{locatorButtonPressed:x,checkoutButtonRef:s,isOpen:p,setIsOpen(t){p.value=t,u()},hasBasketCount:B,search:u,refesh:w,results:a,status_dropoff:v,total_orders:k,total_dropoffs:y,form:o,confirm:l,addToast:h}}},W={class:"inline-flex absolute top-0 left-0 justify-center items-center -m-1 w-4 h-4 text-xs font-bold leading-none text-white bg-red-600 rounded-full"},X=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})],-1),Z={class:"flex flex-col fixed inset-y-0 right-0 w-full max-w-sm bg-white"},$={class:"flex justify-between items-center p-4 shadow"},tt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),et=[tt],ot={class:"flex-1 flex flex-col"},st={class:"flex-1 relative"},nt={class:"absolute inset-0 overflow-y-scroll"},rt={class:"flex flex-col divide-y divide-gray-100"},at={key:"orderIndex"},lt={class:"flex flex-col w-24"},it=["src","alt"],dt={class:"text-xs font-semibold leading-tight"},ct={class:"mt-2 text-gray-800 leading-normal text-sm"},ut={class:"flex items-center mt-2 text-gray-800 leading-normal text-sm"},ft=["onChange","onUpdate:modelValue"],pt={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 text-red-600"},_t=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),ht=[_t],mt={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 text-purple-600"},gt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),vt=[gt],xt={class:"py-6 px-4 bg-gray-50"},wt={class:"flex justify-between"},yt=e("div",{class:"text-center font-semibold"},"Total Dropoffs",-1),kt={class:"text-center font-semibold"},bt={class:"flex justify-between"},Ct=e("div",{class:"text-center font-semibold text-gray-600"},"Total Orders",-1),Bt={class:"text-center font-semibold"},Tt={class:"flex flex-col space-y-2 mt-4"};function Dt(p,s,B,o,a,T){const w=_("DialogOverlay"),u=_("TransitionChild"),v=_("DialogTitle"),y=_("BarcodeSearchVerifyModal"),k=_("Dialog"),x=_("TransitionRoot");return c(),d(C,null,[p.$page.props.auth.user.basketCount?(c(),d("button",{key:0,onClick:s[0]||(s[0]=l=>o.setIsOpen(!0)),class:"fixed right-4 bottom-8 p-2 bg-purple-900 rounded-full hover:bg-purple-800"},[e("span",W,r(p.$page.props.auth.user.basketCount),1),X])):z("",!0),f(x,{appear:"",as:"template",show:o.isOpen},{default:g(()=>[f(k,{initialFocus:o.checkoutButtonRef,class:"overflow-hidden fixed inset-0 z-10",open:o.isOpen,onClose:o.setIsOpen},{default:g(()=>[f(u,{enter:"transition-opacity ease-in-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"transition-opacity ease-in-out duration-300","leave-from":"opacity-100","leave-to":"opacity-0",as:"template"},{default:g(()=>[f(w,{class:"absolute inset-0 bg-purple-300 bg-opacity-40"})]),_:1}),f(u,{enter:"transform ease-in-out transition-transform duration-300","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform ease-in-out transition-transform duration-300","leave-from":"translate-x-0","leave-to":"translate-x-full",as:"template"},{default:g(()=>[e("div",Z,[e("div",$,[f(v,{class:"text-xl font-bold"},{default:g(()=>[S("Basket")]),_:1}),f(y,{onReloadBasket:s[1]||(s[1]=l=>o.refesh())}),e("button",{onClick:s[2]||(s[2]=l=>o.setIsOpen(!1)),class:"p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black"},et)]),e("div",ot,[e("div",st,[e("div",nt,[e("div",rt,[(c(!0),d(C,null,q(o.results,(l,h)=>(c(),d("div",at,[(c(!0),d(C,null,q(l.order_items,(t,n)=>(c(),d("div",{key:n,class:"flex p-4 space-x-4"},[e("div",lt,[e("img",{class:"mb-0.5",src:t.goods_image,alt:t.product_name},null,8,it)]),e("div",null,[e("div",dt,r(t.product_name)+": "+r(t.bar_code),1),e("div",ct,r(t.order_quantity)+" x "+r(t.currency)+r(t.product_price)+" = "+r(t.currency)+r(t.total_price),1),e("div",ut,[F(e("input",{onChange:i=>o.status_dropoff(h,n),"onUpdate:modelValue":i=>t.drop_quantity=i,type:"number",class:"border border-gray-200 h-6 w-12 px-0 text-center"},null,40,ft),[[L,t.drop_quantity]]),e("button",null,[t.drop_status==0?(c(),d("svg",pt,ht)):(c(),d("svg",mt,vt))])])])]))),128))]))),128))])])]),e("div",xt,[e("div",wt,[yt,e("div",kt,r(o.total_dropoffs),1)]),e("div",bt,[Ct,e("div",Bt,r(o.total_orders),1)]),e("div",Tt,[e("button",{class:"bg-purple-600 p-3 text-white rounded-full hover:bg-purple-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple",ref:"checkoutButtonRef",onClick:s[3]||(s[3]=l=>o.confirm())}," Confirm ",512),e("button",{class:"p-3 bg-white text-gray-500 hover:text-black rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-300",onClick:s[4]||(s[4]=l=>o.setIsOpen(!1))}," Continue confirm ")])])])])]),_:1})]),_:1},8,["initialFocus","open","onClose"])]),_:1},8,["show"])],64)}const zt=E(Q,[["render",Dt]]);export{zt as default};
